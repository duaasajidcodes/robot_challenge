#!/usr/bin/env ruby
# frozen_string_literal: true

# Add lib directory to load path
$LOAD_PATH.unshift(File.expand_path('../lib', __dir__))

require 'robot_challenge'

# Parse command line arguments using dedicated parser
parser = RobotChallenge::CliArgumentParser.new

# Display help if requested
if parser.help_requested?
  parser.display_help
  exit(0)
end

# Validate arguments
begin
  parser.validate!
rescue ArgumentError => e
  warn "Error: #{e.message}"
  exit(1)
end

# Create and run the application
begin
  app = RobotChallenge::Application.new(
    table_width: parser.table_width,
    table_height: parser.table_height,
    input_source: parser.input_file || $stdin,
    output_formatter: parser.output_format ? RobotChallenge::OutputFormatterFactory.create(parser.output_format) : nil
  )
  app.run
rescue StandardError => e
  warn "Error: #{e.message}"
  exit(1)
end
